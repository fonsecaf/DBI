







determine the period and extracting the raw data
NB: even if histroy is in raw data, we should only load the current week










































































find the most recent period from the fact table for the current measure











if there is data in kriTable for the current measure then get the most recent date loaded


















if there is no previouly loaded data then get the prev week














































































































gen_recs determines if the data has already been loaded for the current measure


















create a loop each week, currently set to do only the prev week to this week
can be modified to do catchups if the data did not load previouly. (Data should always be loaded in the current week as historical data changes)

















create a dynamic select for the raw data
for the first iteration







































this will set a index for the worst offending record for the selected week/store/measure

















this will set a index for the worst offending record for the selected week/store/measure


















if there are more weeks to load then load the rest of the weeks






























append to the fact tables





































































































thsi will be the same as above except will run for measure created for the first time.






































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































